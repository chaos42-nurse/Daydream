<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daydream | Open Spotify</title>
  <style>
    :root {
      color-scheme: dark;
      font-family: Arial, sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: #121212;
      color: #ffffff;
      text-align: center;
      padding: 24px;
    }

    main {
      max-width: 560px;
      line-height: 1.5;
    }

    a,
    button {
      color: #1db954;
      font: inherit;
    }

    button {
      margin-top: 12px;
      border: 1px solid #1db954;
      background: transparent;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
    }

    small {
      display: block;
      margin-top: 12px;
      color: #b3b3b3;
    }
  </style>
</head>
<body>
  <main>
    <h1>Opening Spotifyâ€¦</h1>
    <p>If the app does not open automatically, tap below:</p>
    <p><a id="spotify-link" href="https://open.spotify.com/track/4spyMABCbID9Tem2ukcbnz">Open track on Spotify</a></p>
    <button id="open-app" type="button">Open in Spotify app</button>
    <small>Tab auto-close depends on browser security rules and may be blocked.</small>
  </main>

  <script>
    const trackId = "4spyMABCbID9Tem2ukcbnz";
    const spotifyWebUrl = `https://open.spotify.com/track/${trackId}`;
    const spotifyAppUri = `spotify:track:${trackId}`;
    const spotifyAndroidIntent = `intent://track/${trackId}#Intent;scheme=spotify;package=com.spotify.music;end`;

    const openButton = document.getElementById("open-app");
    const link = document.getElementById("spotify-link");

    let fallbackTimer;

    function fallbackToWeb() {
      window.location.replace(spotifyWebUrl);
    }

    function tryCloseTab() {
      window.open("", "_self");
      window.close();
    }

    function attemptOpen() {
      const ua = navigator.userAgent || "";
      const isAndroid = /Android/i.test(ua);
      const target = isAndroid ? spotifyAndroidIntent : spotifyAppUri;

      // Try opening app URI / Android intent.
      window.location.href = target;

      // Fallback to Spotify web player if app launch fails.
      fallbackTimer = setTimeout(fallbackToWeb, 1000);

      // Try closing tab after handoff.
      setTimeout(tryCloseTab, 1700);
    }

    // If app opens, page goes hidden: cancel fallback.
    document.addEventListener("visibilitychange", () => {
      if (document.hidden && fallbackTimer) {
        clearTimeout(fallbackTimer);
      }
    });

    openButton.addEventListener("click", attemptOpen);
    link.setAttribute("href", spotifyWebUrl);

    attemptOpen();
  </script>
</body>
</html>
